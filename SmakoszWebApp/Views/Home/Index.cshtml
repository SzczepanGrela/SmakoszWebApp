@model SmakoszWebApp.ViewModels.HomePageViewModel
@{
    ViewData["Title"] = "Strona Główna";
}

<!-- Enhanced Hero Section -->
<div class="hero-section text-center text-white d-flex align-items-center justify-content-center">
    <div class="container">
        <h1 class="display-4 fw-bold mb-3">Znajdź najlepszy smak w mieście</h1>
        <p class="lead mb-4">Odkrywaj i oceniaj dania, a nie tylko restauracje.</p>
        
        <!-- Quick Stats -->
        <div class="row justify-content-center mb-4">
            <div class="col-auto">
                <div class="d-flex gap-4 text-center">
                    <div>
                        <div class="fw-bold fs-4">@Model.Stats.TotalDishes.ToString("N0")</div>
                        <small>Dań</small>
                    </div>
                    <div>
                        <div class="fw-bold fs-4">@Model.Stats.TotalRestaurants</div>
                        <small>Restauracji</small>
                    </div>
                    <div>
                        <div class="fw-bold fs-4">@Model.Stats.TotalReviews.ToString("N0")</div>
                        <small>Ocen</small>
                    </div>
                </div>
            </div>
        </div>

        <!-- Search Form -->
        <div class="row justify-content-center">
            <div class="col-lg-8">
                <form asp-controller="Search" asp-action="Index" method="get" class="d-flex flex-column flex-md-row gap-2">
                    <input name="query" class="form-control form-control-lg" type="search" placeholder="Jakiego dania szukasz? (np. pizza, ramen...)">
                    <input name="location" class="form-control form-control-lg" type="search" placeholder="Gdzie? (np. Rzeszów, cała Polska)">
                    <button class="btn btn-primary btn-lg" type="submit">
                        <i class="fa-solid fa-magnifying-glass"></i> Szukaj
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>

<div class="container mt-5">
    
    <!-- Quick Actions Bar -->
    <section class="mb-5">
        <div class="row">
            <div class="col-md-8">
                <div class="d-flex flex-wrap gap-2 mb-3">
                    <button class="btn btn-outline-primary btn-sm" onclick="getRandomDish()">
                        <i class="fa-solid fa-dice me-1"></i> Losowe danie
                    </button>
                    <button class="btn btn-outline-success btn-sm" onclick="showQuickFilters()">
                        <i class="fa-solid fa-filter me-1"></i> Szybkie filtry
                    </button>
                    <button class="btn btn-outline-info btn-sm" onclick="nearbyRestaurants()">
                        <i class="fa-solid fa-location-dot me-1"></i> W pobliżu
                    </button>
                </div>
            </div>
            <div class="col-md-4 text-md-end">
                @if (Model.IsUserLoggedIn)
                {
                    <a asp-controller="Recommendations" asp-action="Index" class="btn btn-primary">
                        <i class="fa-solid fa-sparkles me-1"></i> Twoje rekomendacje
                    </a>
                }
                else
                {
                    <a href="/Identity/Account/Login" class="btn btn-outline-primary">
                        <i class="fa-solid fa-user me-1"></i> Zaloguj się
                    </a>
                }
            </div>
        </div>
    </section>


    <!-- Recommendations Preview -->
    @if (Model.IsUserLoggedIn)
    {
        <section class="mb-5">
            <div class="row align-items-center mb-3">
                <div class="col">
                    <h2>
                        <i class="fa-solid fa-sparkles text-warning me-2"></i>
                        Rekomendacje dla Ciebie
                    </h2>
                </div>
                <div class="col-auto">
                    <a asp-controller="Recommendations" asp-action="Index" class="btn btn-outline-primary">
                        Zobacz wszystkie <i class="fa-solid fa-arrow-right ms-1"></i>
                    </a>
                </div>
            </div>
            <div class="row">
                @foreach (var dish in Model.RecommendedDishes)
                {
                    <div class="col-md-4 mb-3">
                    <partial name="_DishCardPartial" model="dish" view-data='@new ViewDataDictionary(ViewData) { { "ShowBadge", true }, { "BadgeText", "Polecane" }, { "BadgeClass", "bg-warning text-dark" }, { "ShowReviewCount", false } }' />
                </div>
                }
            </div>
        </section>
    }

    <!-- Popular Categories -->
    <section class="mb-5">
        <h2 class="text-center mb-4">Popularne kategorie</h2>
        <div class="row g-3">
            @foreach (var category in Model.PopularCategories)
            {
                <div class="col-6 col-md-4 col-lg-2">
                    <a asp-controller="Search" asp-action="Index" asp-route-query="@category" class="card category-card text-decoration-none text-dark">
                        <div class="card-body text-center">
                            <span class="fs-4">
                                @{
                                    var icon = category switch
                                    {
                                        "Pizza" => "🍕",
                                        "Burgery" => "🍔",
                                        "Sushi" => "🍣",
                                        "Ramen" => "🍜",
                                        "Pierogi" => "🥟",
                                        "Desery" => "🍰",
                                        "Pasta" => "🍝",
                                        "Kebab" => "🥙",
                                        "Tacos" => "🌮",
                                        "Curry" => "🍛",
                                        "Salads" => "🥗",
                                        "Seafood" => "🦐",
                                        _ => "🍴"
                                    };
                                    @icon
                                }
                            </span>
                            <span class="d-block mt-2">@category</span>
                        </div>
                    </a>
                </div>
            }
        </div>
    </section>

    <!-- New Discoveries -->
    <section class="mb-5">
        <h2 class="mb-4">
            <i class="fa-solid fa-compass text-info me-2"></i>
            Najnowsze odkrycia
        </h2>
        <div class="row">
            @foreach (var dish in Model.NewDiscoveries)
            {
                <div class="col-md-6 mb-4">
                    <partial name="_DishCardPartial" model="dish" view-data='@new ViewDataDictionary(ViewData) { { "ShowBadge", true }, { "BadgeText", "Nowe" }, { "BadgeClass", "bg-info" } }' />
                </div>
            }
        </div>
    </section>


    <!-- Quick Choices -->
    <section class="mb-5">
        <h2 class="mb-4">
            <i class="fa-solid fa-lightning text-warning me-2"></i>
            Szybkie wybory
        </h2>
        <div class="row g-3">
            @foreach (var choice in Model.QuickChoices)
            {
                <div class="col-md-4 col-lg-2">
                    <a href="#" class="card quick-choice-card text-decoration-none text-dark" onclick="searchByMood('@choice')">
                        <div class="card-body text-center py-3">
                            <span class="fw-bold">@choice</span>
                        </div>
                    </a>
                </div>
            }
        </div>
    </section>

    <!-- Highly Rated Dishes -->
    <section class="mb-5">
        <h2 class="mb-4">
            <i class="fa-solid fa-star text-warning me-2"></i>
            Ostatnio wysoko oceniane
        </h2>
        <div class="row">
            @foreach (var dish in Model.HighlyRatedDishes)
            {
                <div class="col-md-6 col-lg-3 mb-4">
                    <partial name="_DishCardPartial" model="dish" />
                </div>
            }
        </div>
    </section>

    <!-- Recent Reviews -->
    <section class="mb-5">
        <h2 class="mb-4">
            <i class="fa-solid fa-comments text-primary me-2"></i>
            Najnowsze opinie
        </h2>
        <div class="row">
            @foreach (var review in Model.RecentReviews)
            {
                <div class="col-md-4 mb-3">
                    @Html.Partial("_ReviewCardPartial", review)
                </div>
            }
        </div>
    </section>
</div>

<!-- Quick Filters Modal -->
<div class="modal fade" id="quickFiltersModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Szybkie filtry</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="row g-2">
                    <div class="col-6">
                        <button class="btn btn-outline-primary btn-sm w-100" onclick="applyQuickFilter('price', 'low')">
                            <i class="fa-solid fa-money-bill me-1"></i>Tanie
                        </button>
                    </div>
                    <div class="col-6">
                        <button class="btn btn-outline-primary btn-sm w-100" onclick="applyQuickFilter('price', 'high')">
                            <i class="fa-solid fa-gem me-1"></i>Premium
                        </button>
                    </div>
                    <div class="col-6">
                        <button class="btn btn-outline-success btn-sm w-100" onclick="applyQuickFilter('diet', 'vegetarian')">
                            <i class="fa-solid fa-leaf me-1"></i>Wegetariańskie
                        </button>
                    </div>
                    <div class="col-6">
                        <button class="btn btn-outline-danger btn-sm w-100" onclick="applyQuickFilter('spice', 'hot')">
                            <i class="fa-solid fa-pepper-hot me-1"></i>Ostre
                        </button>
                    </div>
                    <div class="col-6">
                        <button class="btn btn-outline-info btn-sm w-100" onclick="applyQuickFilter('rating', 'high')">
                            <i class="fa-solid fa-star me-1"></i>Wysoko oceniane
                        </button>
                    </div>
                    <div class="col-6">
                        <button class="btn btn-outline-warning btn-sm w-100" onclick="applyQuickFilter('time', 'recent')">
                            <i class="fa-solid fa-clock me-1"></i>Nowe
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    function getRandomDish() {
        const dishes = @Html.Raw(Json.Serialize(Model.AllDishesForRandom));
        const randomDish = dishes[Math.floor(Math.random() * dishes.length)];
        
        if (randomDish) {
            window.location.href = `/Dish/Index/${randomDish.Id}`;
        }
    }

    function showQuickFilters() {
        new bootstrap.Modal(document.getElementById('quickFiltersModal')).show();
    }

    function applyQuickFilter(type, value) {
        let query = '';
        switch (type) {
            case 'price':
                query = value === 'low' ? 'tanie' : 'premium';
                break;
            case 'diet':
                query = 'wegetariańskie';
                break;
            case 'spice':
                query = 'ostre';
                break;
            case 'rating':
                query = 'wysoko oceniane';
                break;
            case 'time':
                query = 'nowe';
                break;
        }
        
        window.location.href = `/Search/Index?query=${encodeURIComponent(query)}`;
        bootstrap.Modal.getInstance(document.getElementById('quickFiltersModal')).hide();
    }

    function searchByMood(mood) {
        window.location.href = `/Search/Index?query=${encodeURIComponent(mood)}`;
    }

    function nearbyRestaurants() {
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(function(position) {
                window.location.href = `/Search/Index?location=w pobliżu&lat=${position.coords.latitude}&lng=${position.coords.longitude}`;
            }, function() {
                alert('Nie udało się uzyskać lokalizacji. Spróbuj wpisać miasto w wyszukiwarkę.');
            });
        } else {
            alert('Twoja przeglądarka nie obsługuje geolokalizacji.');
        }
    }
</script>